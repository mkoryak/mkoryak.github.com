<!DOCTYPE html>
<html>
<head>
<title>jQuery.floatThead</title>

<link rel="stylesheet" href="http://glench.com/misc/graph-slider/jquery-ui-1.9.0.custom/css/ui-lightness/jquery-ui-1.9.0.custom.min.css" type="text/css" />

    <link href="../lib/bootstrap.css" media="screen" rel="stylesheet" type="text/css"/>

    <link rel="stylesheet/less" type="text/css" href="../lib/styles.less">

    <script type="text/javascript" src="http://glench.com/misc/graph-slider/underscore-min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript" src="http://glench.com/misc/graph-slider/jquery-ui-1.9.0.custom/js/jquery-ui-1.9.0.custom.min.js"></script>
<script type="text/javascript" src="http://glench.com/misc/graph-slider/DataTables-1.9.4/media/js/jquery.dataTables.min.js"></script>
<script type="text/javascript">
</script>
<script type="text/javascript" src="http://glench.com/misc/graph-slider/flot/jquery.flot.js"></script>
<script type="text/javascript" src="http://glench.com/misc/graph-slider/flot/jquery.flot.time.js"></script>
<script type="text/javascript" src="http://glench.com/misc/graph-slider/flot/jquery.flot.selection.js"></script>


    <script src="../lib/less.js" type="text/javascript"></script>
    <script src="https://rawgithub.com/mkoryak/floatThead/ie8fixes/jquery.floatThead.js"></script>
    <!--<script src="https://rawgithub.com/mkoryak/floatThead/master/jquery.floatThead.js"></script>-->
    <!--<script type='text/javascript' src="../jquery.floatThead.js"></script>-->

    <script type='text/javascript' src="../site.js"></script>
    <script type='text/javascript' src="../lib/bootstrap.js"></script>

<style type="text/css">
    table {
        width: 200px;
        margin-top: 15px;
    }
    body {
        padding-top: 81px;
    }
    td {
        text-align: center;
    }
    .dataTables_length,
    .dataTables_filter,
    .dataTables_paginate,
    .dataTables_info { display: none; }
    .sorting, .sorting_asc, .sorting_desc { cursor: pointer; background-color: #eee; }
    .sorting { background: #eee url('http://glench.com/misc/graph-slider/DataTables-1.9.4/media/images/sort_both.png') no-repeat center right; }
    .sorting_asc { background: #eee url('http://glench.com/misc/graph-slider/DataTables-1.9.4/media/images/sort_asc.png') no-repeat center right; }
    .sorting_desc { background: #eee url('http://glench.com/misc/graph-slider/DataTables-1.9.4/media/images/sort_desc.png') no-repeat center right; }

    #date-filter {
        height: 100px;
        width: 230px;
    }
    #links li{
        display: inline;
    }

    #slider {
        width: 198px;
        position: absolute;
        left: 25px;
        margin-top: -22px;
        height: 5px;
    }
    #slider .ui-slider-handle.ui-state-default.ui-corner-all {
        height: 9px;
        width: 10px;
    }
    #slider.ui-widget-content {
        border: 1px solid black;
    }
</style>

</head>

<body>
<a href="https://github.com/mkoryak/floatThead"><img style="position: absolute; top: 81px; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>

<div class='container'>

<div class="navbar navbar-fixed-top" id='navbar'>
    <div class="navbar">
        <div class="navbar-inner">
            <a class="brand" href="/floatThead/" style='margin-left: 0'>jQuery.floatThead</a>
            <ul class="nav">
                <li><a href="/floatThead/#intro">Intro</a></li>
                <li><a href="/floatThead/#usage">Usage</a></li>
                <li><a href="/floatThead/#options">Options</a></li>
                <li><a href="/floatThead/#examples">Examples</a></li>
                <li class='active'><a href="examples/big-table.htm">More Examples</a></li>
                <li><a href="/floatThead/datatables.htm">Datatables Example</a></li>
                <li><a href="/floatThead/other-libs.htm">Similar Plugins</a></li>
                <li><a href="/floatThead/#issues">Known Issues</a></li>
                <li><a href="/floatThead/#download">Download</a></li>
            </ul>
            <a class='btn btn-info btn-small' style='margin:7px 15px 0 0;' href="https://github.com/mkoryak/floatThead">View on GitHub <i class='icon-home icon-white'></i></a>
        </div>
    </div>
    <div class="navbar navbar-fixed-top navbar-inverse" style='top: 40px;'>
        <div class="navbar-inner">
            <ul class="nav" id='dynamic-nav'>
                <!-- populated by /site.js -->
            </ul>
        </div>
    </div>

</div>

<div class='row'>
    <div class='span12' id='intro'>
        <h1>A more "real" example</h1>
        Most of the code here is copied from <a href="http://glench.com/misc/graph-slider/" target="_blank">http://glench.com/misc/graph-slider/</a>

    </div>
</div>
<div class='row'>
    <div class='span6' style='position:relative;'>
        <div class='controls' data-spy="affix" >
            <h2>Pickup Schedule</h2>
            <div id="date-filter"></div>
            <div id="slider"></div>
            <ul id="links">
                <li><a href="#null" id="select-today">Today</a></li>
                <li><a href="#null" id="select-tomorrow">Tomorrow</a></li>
                <li><a href="#null" id="select-all">Reset</a></li>
            </ul>
        </div>
    </div>
    <div class='span6'>
        <table id='demo0'>
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>
</div>


<div id="footer" style="margin-top:100px">
<p>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-Noncommercial 3.0 Unported License</a>. By <a href="http://glench.com">Glen Chiacchieri</a>.</p>
</div>




<script type="text/javascript">
    Array.prototype.random = function () {
        return this[Math.floor(Math.random() * this.length)];
    };
    var items = ['lions', 'tigers', 'bears'],
        addDays = function(days) {
            var today = new Date(),
                futureDate = new Date();
            futureDate.setDate(today.getDate()+days);
            return futureDate;
        },
        formatDate = function(day) {
            return ((day.getMonth() + 1) + '/' + day.getDate());
        },
        euclidianDistance = function(x1, y1, x2, y2) {
            return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
        },
        headers = [
            {sTitle: 'Number', bVisible: false},
            {sTitle: 'Day', bVisible: false},
            {sTitle: 'Item'},
            {sTitle: 'Pickup Date', aDataSort: [4]},
            {sTitle: 'Pickup Date Sortable', bVisible: false}
        ],
        data = [],
        plotData = [],
        numberItemsPerDay = [5, 19, 25, 11, 0, 1, 8, 4, 5, 8, 0, 0, 3, 5, 3, 0, 1, 0, 0, 0, 0, 0, 0, 2, 8, 0, 0, 2, 1];

    var num = 0;
    _.each(numberItemsPerDay, function(numItems, day) {
        plotData.push([day, numItems]);
        for (var i = 0; i < numItems; ++i) {
            var dateInLoop = addDays(day);
            data.push([num, day, items.random(), formatDate(dateInLoop), dateInLoop.getTime()]);
            num++;
        }
    });

    $(function() {

        // make slider
        $('#slider').slider({
            min: 0,
            max: numberItemsPerDay.length - 1,
            range: true,
            values: [0, numberItemsPerDay.length - 1],
            slide: function(evt, ui) {
                $plot.setSelection({xaxis: {from: ui.values[0], to: ui.values[1]}});
                $table.fnDraw();
            },
            change: function(evt, ui) {
                // don't trigger infinite loop of events by passing true
                $plot.setSelection({xaxis: {from: ui.values[0], to: ui.values[1]}}, true);
                $table.fnDraw();
            }
        });

        $.fn.dataTableExt.afnFiltering.push(
            function( oSettings, aData, iDataIndex ) {
                var column_index = 1; // day column
                var values = $('#slider').slider('option', 'values');

                var row_data = parseInt(aData[column_index], 10);

                return row_data >= values[0] && row_data <= values[1];
            }
        );

        // make table
        var $table = $('table').dataTable({
            aaData: data,
            aoColumns: headers,
            aaSorting: [[3, 'asc']],
            bPaginate: false
        });

        // make plot
        var $plot = $.plot($('#date-filter'), [plotData], {
            xaxis: {
                tickFormatter: function(val, axis) {
                    return formatDate(addDays(val));
                }
            },
            grid: {
                labelMargin: 10
            },
            selection: {mode: 'x'}
        });
        $plot.setSelection({xaxis: {from: 0, to: numberItemsPerDay.length - 1}})

        // bindings

        $(document).mousemove(function(e){
            window.mouseXPos = e.pageX;
            window.mouseYPos = e.pageY;
        });

        var updateSlider = function(evt, ranges) {
            // apparently on starting to select, ranges can be null
            if (_.isNull(ranges)){ return; }

            var from = Math.round(ranges.xaxis.from),
                to = Math.round(ranges.xaxis.to);
            $('#slider').slider('option', 'values', [from, to]);
            //ADDED:
            $('#demo0').floatThead('reflow');
        };
        $('#date-filter').on('plotselected', updateSlider);
        $('#date-filter').on('plotselecting', updateSlider);

        // buttons
        $('#select-all').on('click', function(evt) {
            evt.preventDefault();
            $('#slider').slider('option', 'values', [0, numberItemsPerDay.length - 1]);
            //ADDED:
            $('#demo0').floatThead('reflow');
        });
        $('#select-today').on('click', function(evt) {
            evt.preventDefault();
            $('#slider').slider('option', 'values', [0, 0]);
            //ADDED:
            $('#demo0').floatThead('reflow');
        });
        $('#select-tomorrow').on('click', function(evt) {
            evt.preventDefault();
            $('#slider').slider('option', 'values', [1, 1]);

            //ADDED:
            $('#demo0').floatThead('reflow');
        });



        //and now here is some code i added!

        var $nav = $('.navbar-inverse');
        $('#demo0').floatThead({
            scrollingTop: function(){
                return 40 + $nav.height();
            }
        });

    });
</script>

</div>
</html>
